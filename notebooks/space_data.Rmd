---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(sf)
library(rmapshaper)
library(here)
library(leaflet)
```

```{r}
scotland <- read_sf(here("data_raw/SG_NHS_HealthBoards_2019/SG_NHS_HealthBoards_2019.shp"))
```

```{r}
class(scotland)
```

```{r}
head(scotland, 14)
```

```{r}
scotland_geometry <- st_geometry(scotland)

scotland_geometry
```

```{r}
scotland_simple <- ms_simplify(scotland)
```

```{r}
plot(scotland_simple)
```

```{r}
plot(scotland_simple [2])
```

```{r}
ggplot(data = scotland_simple) +
  geom_sf(aes()) +
  theme_minimal() +
  ggtitle("Scotland") + 
    xlab("Longitude") + ylab("Latitude")
```

```{r}
lothian <- scotland_simple %>% 
  filter(HBName == "Lothian")
```

```{r}
plot(lothian)
```

```{r}
ggplot(data = lothian) +
  geom_sf(aes()) +
  theme_minimal() +
  ggtitle("Lothian") + 
    xlab("Longitude") + ylab("Latitude")
```

```{r}
alcohol <- read_csv("../data_clean/alcohol.csv") %>% 
  filter(sex == "All") %>% 
  filter(date_code == "2016-2019") %>% 
  filter(alcohol_consumption == "Hazardous/Harmful drinker")

scotland_simple %>% 
  left_join(alcohol, by = c("HBCode" = "feature_code")) %>% 
ggplot() +
  geom_sf(aes(group = hb_name, fill = value)) +
  theme_minimal() +
  ggtitle("Alcohol Consumption in Scotland") + 
  scale_fill_gradient(low = "green", high = "red")
```

```{r}
obesity <- read_csv("../data_clean/obesity.csv") %>% 
  filter(sex == "All") %>% 
  filter(date_code == "2016-2019") %>% 
  filter(obesity == "Obese")

scotland_simple %>% 
  left_join(obesity, by = c("HBCode" = "feature_code")) %>% 
ggplot() +
  geom_sf(aes(group = hb_name, fill = value)) +
  theme_minimal() +
  ggtitle("Obesity in Scotland") + 
    xlab("Longitude") + ylab("Latitude") +
  scale_fill_gradient(low = "green", high = "red")
```

```{r}
smoking_status <- read_csv("../data_clean/smoking_status.csv") %>% 
  filter(sex == "All") %>% 
  filter(date_code == "2016-2019") %>% 
  filter(smoking_status == "Current smoker")

scotland_simple %>% 
  left_join(smoking_status, by = c("HBCode" = "feature_code")) %>% 
ggplot() +
  geom_sf(aes(group = hb_name, fill = value)) +
  theme_minimal() +
  ggtitle("Smoking Status in Scotland") + 
    xlab("Longitude") + ylab("Latitude") +
  scale_fill_gradient(low = "green", high = "red")
```

```{r}
e_cig <- read_csv("../data_clean/e_cig.csv") %>% 
  filter(sex == "All") %>% 
  filter(date_code == "2016-2019") %>% 
  filter(e_cigarette_use == "Currently using")

scotland_simple %>% 
  left_join(e_cig, by = c("HBCode" = "feature_code")) %>% 
ggplot() +
  geom_sf(aes(group = hb_name, fill = value)) +
  theme_minimal() +
  ggtitle("E-cigarette use in Scotland") + 
    xlab("Longitude") + ylab("Latitude") +
  scale_fill_gradient(low = "green", high = "red")
```

```{r}
summary_activity <- read_csv("../data_clean/summary_activity.csv") %>% 
  filter(sex == "All") %>% 
  filter(date_code == "2016-2019") %>% 
  filter(summary_activity_levels == "Meets recommendations")

scotland_simple %>% 
  left_join(summary_activity, by = c("HBCode" = "feature_code")) %>% 
ggplot() +
  geom_sf(aes(group = hb_name, fill = value)) +
  theme_minimal() +
  ggtitle("Summary Activity in Scotland") + 
    xlab("Longitude") + ylab("Latitude") +
  scale_fill_gradient(low = "green", high = "red")
```

```{r}
bins <- c(0, 10, 20, 50, 100, 200, 500, 1000, Inf)
pal <- colorBin("YlOrRd", domain = states$density, bins = bins)

labels <- sprintf(
  "<strong>%s</strong><br/>%g people / mi<sup>2</sup>",
  states$name, states$density
) %>% lapply(htmltools::HTML)

leaflet(scotland_simple) %>%
  setView(-96, 37.8, 4) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(density),
    weight = 2,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    highlight = highlightOptions(
      weight = 5,
      color = "#666",
      dashArray = "",
      fillOpacity = 0.7,
      bringToFront = TRUE),
    label = labels,
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "15px",
      direction = "auto")) %>%
  addLegend(pal = pal, values = ~density, opacity = 0.7, title = NULL,
    position = "bottomright")
```
]

